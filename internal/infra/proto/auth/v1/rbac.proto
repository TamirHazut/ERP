syntax = "proto3";

package auth.v1;

option go_package = "erp.localhost/internal/infra/model/auth/v1;authv1";

import "infra/v1/infra.proto";
import "auth/v1/role.proto";
import "auth/v1/permission.proto";



// ============================================================================
// User Role Assignment
// ============================================================================

message AssignRolesRequest {
    infra.v1.UserIdentifier identifier = 1;        // User to assign roles to
    repeated string role_ids = 2;                  // Role IDs to assign
    string assigned_by = 3;                        // Who is assigning the roles
}

message RemoveRolesRequest {
    infra.v1.UserIdentifier identifier = 1;        // User to remove roles from
    repeated string role_ids = 2;                  // Role IDs to remove
    string removed_by = 3;                         // Who is removing the roles
}


// ============================================================================
// Dedicated Service Request/Response Messages
// ============================================================================

// Role Service Messages
message CreateRoleRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    auth.v1.Role role = 2;                       // Role data to create
}

message CreateRoleResponse {
    string role_id = 1;
}

message UpdateRoleRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    auth.v1.Role role = 2;                       // Role data to update
}

message GetRoleRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    string role_id = 2;                            // Role ID to retrieve
    string target_tenant_id = 3;                   // Target tenant (for cross-tenant operations)
}

message ListRolesRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    string target_tenant_id = 2;                   // Target tenant (for cross-tenant operations)
    optional infra.v1.PaginationRequest pagination = 3;
}

message ListRolesResponse {
    repeated auth.v1.Role roles = 1;
    infra.v1.PaginationResponse pagination = 2;
}

message DeleteRoleRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    string role_id = 2;                            // Role ID to delete
    string target_tenant_id = 3;                   // Target tenant (for cross-tenant operations)
}

// Permission Service Messages
message CreatePermissionRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    auth.v1.Permission permission = 2;           // Permission data to create
}

message CreatePermissionResponse {
    string permission_id = 1;
}

message UpdatePermissionRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    auth.v1.Permission permission = 2;           // Permission data to update
}

message GetPermissionRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    string permission_id = 2;                      // Permission ID to retrieve
    string target_tenant_id = 3;                   // Target tenant (for cross-tenant operations)
}

message ListPermissionsRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    string target_tenant_id = 2;                   // Target tenant (for cross-tenant operations)
    optional infra.v1.PaginationRequest pagination = 3;
}

message ListPermissionsResponse {
    repeated auth.v1.Permission permissions = 1;
    infra.v1.PaginationResponse pagination = 2;
}

message DeletePermissionRequest {
    infra.v1.UserIdentifier identifier = 1;        // Requestor identity
    string permission_id = 2;                      // Permission ID to delete
    string target_tenant_id = 3;                   // Target tenant (for cross-tenant operations)
}

// Verification Service Messages
message CheckPermissionsRequest {
    infra.v1.UserIdentifier identifier = 1;        // User to check
    repeated string permissions = 2;               // Permissions to check
}

message CheckPermissionsResponse {
    map<string, bool> permissions = 1;             // Map of permission -> has_permission
}

message HasPermissionRequest {
    infra.v1.UserIdentifier identifier = 1;        // User to check
    string permission = 2;                         // Permission to check
    string target_tenant_id = 3;                   // Target tenant (for cross-tenant operations)
}

message HasPermissionResponse {
    bool has_permission = 1;
}

message GetUserPermissionsRequest {
    infra.v1.UserIdentifier identifier = 1;        // User to check
}

message GetUserPermissionsResponse {
    map<string, bool> permissions = 1;             // Map of all user permissions
}

message GetUserRolesRequest {
    infra.v1.UserIdentifier identifier = 1;        // User to check
}

message GetUserRolesResponse {
    repeated string role_ids = 1;                  // List of role IDs
}

message IsSystemTenantUserRequest {
    string tenant_id = 1;                          // Tenant ID to check
}

message IsSystemTenantUserResponse {
    bool is_system_tenant = 1;
}

// ============================================================================
// Dedicated Service Definitions
// ============================================================================

// RoleService provides role management operations
service RoleService {
    rpc CreateRole(CreateRoleRequest) returns (CreateRoleResponse);
    rpc UpdateRole(UpdateRoleRequest) returns (infra.v1.Response);
    rpc GetRole(GetRoleRequest) returns (auth.v1.Role);
    rpc ListRoles(ListRolesRequest) returns (ListRolesResponse);
    rpc DeleteRole(DeleteRoleRequest) returns (infra.v1.Response);
}

// PermissionService provides permission management operations
service PermissionService {
    rpc CreatePermission(CreatePermissionRequest) returns (CreatePermissionResponse);
    rpc UpdatePermission(UpdatePermissionRequest) returns (infra.v1.Response);
    rpc GetPermission(GetPermissionRequest) returns (auth.v1.Permission);
    rpc ListPermissions(ListPermissionsRequest) returns (ListPermissionsResponse);
    rpc DeletePermission(DeletePermissionRequest) returns (infra.v1.Response);
}

// VerificationService provides permission and role verification operations
service VerificationService {
    rpc CheckPermissions(CheckPermissionsRequest) returns (CheckPermissionsResponse);
    rpc HasPermission(HasPermissionRequest) returns (HasPermissionResponse);
    rpc GetUserPermissions(GetUserPermissionsRequest) returns (GetUserPermissionsResponse);
    rpc GetUserRoles(GetUserRolesRequest) returns (GetUserRolesResponse);
    rpc IsSystemTenantUser(IsSystemTenantUserRequest) returns (IsSystemTenantUserResponse);
}