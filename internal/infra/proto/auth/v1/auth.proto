syntax = "proto3";

package auth.v1;

option go_package = "erp.localhost/internal/infra/proto/generated/auth/v1;authv1";

import "infra/v1/infra.proto";

// Authentication
message AuthenticateRequest {
    infra.v1.UserIdentifier identifier = 1;
    string user_password = 2;
    string user_hash = 3;
}

// Tokens
message Tokens {
    string access_token = 1;
    string refresh_token = 2;
}

message ExpiresIn {
    int64 access_token = 1;
    int64 refresh_token = 2;
}

message TokensResponse {
    Tokens tokens = 1;
    ExpiresIn expires_in = 2;
}

message VerifyTokenRequest {
    string access_token = 1;
}

message VerifyTokenResponse {
    bool valid = 1;
}

message RefreshTokenRequest {
    infra.v1.UserIdentifier identifier = 1;
    string refresh_token = 2;
}

message RevokeTokenRequest {
    infra.v1.UserIdentifier identifier = 1;
    string revoked_by = 2;
    Tokens tokens = 3;
}

message RevokeTokenResponse {
    bool revoked = 1;
}

// Tenant-level token management
message RevokeAllTenantTokensRequest {
    infra.v1.UserIdentifier identifier = 1;
    string target_tenant_id = 2;
}

message RevokeAllTenantTokensResponse {
    bool revoked = 1;
    int32 access_tokens_revoked = 2;
    int32 refresh_tokens_revoked = 3;
}

service AuthService {
    // Authentication
    rpc Authenticate(AuthenticateRequest) returns (TokensResponse);

    // Access + Refresh Tokens
    rpc VerifyToken(VerifyTokenRequest) returns (VerifyTokenResponse);
    rpc RefreshToken(RefreshTokenRequest) returns (TokensResponse);
    rpc RevokeToken(RevokeTokenRequest) returns (RevokeTokenResponse);

    // Tenant-level token management
    rpc RevokeAllTenantTokens(RevokeAllTenantTokensRequest) returns (RevokeAllTenantTokensResponse);
}
