syntax = "proto3";

package auth.v1;

option go_package = "erp.localhost/internal/infra/model/auth/v1;authv1";

import "infra/v1/infra.proto";


// =============================================================================
// Login + Logout
// =============================================================================
message LoginRequest {
    string tenant_id = 1;
    oneof account_id {
        string email = 2;
        string username = 3;
    }
    string password = 4;
}

message LogoutRequest {
    infra.v1.UserIdentifier identifier = 1;
    Tokens tokens = 2;
}

message LogoutResponse {
    string message = 1;
}

// Tokens
message Tokens {
    string token = 1;
    string refresh_token = 2;
}

message ExpiresIn {
    int64 token = 1;
    int64 refresh_token = 2;
}

message TokensResponse {
    Tokens tokens = 1;
    ExpiresIn expires_in = 2;
}

message VerifyTokenRequest {
    string token = 1;
}

message VerifyTokenResponse {
    bool valid = 1;
}

message RefreshTokenRequest {
    infra.v1.UserIdentifier identifier = 1;
    string refresh_token = 2;
}

message RevokeTokenRequest {
    infra.v1.UserIdentifier identifier = 1;
    string revoked_by = 2;
    Tokens tokens = 3;
}

message RevokeTokenResponse {
    bool revoked = 1;
}

// Tenant-level token management
message RevokeAllTenantTokensRequest {
    infra.v1.UserIdentifier identifier = 1;
    string target_tenant_id = 2;
}

message RevokeAllTenantTokensResponse {
    bool revoked = 1;
    int32 access_tokens_revoked = 2;
    int32 refresh_tokens_revoked = 3;
}

service AuthService {
    // Authentication - Login + Logout
    rpc Login(LoginRequest) returns (TokensResponse);
    rpc Logout(LogoutRequest) returns (LogoutResponse);

    // Access + Refresh Tokens
    rpc VerifyToken(VerifyTokenRequest) returns (VerifyTokenResponse);
    rpc RefreshToken(RefreshTokenRequest) returns (TokensResponse);
    rpc RevokeToken(RevokeTokenRequest) returns (RevokeTokenResponse);

    // Tenant-level token management
    rpc RevokeAllTenantTokens(RevokeAllTenantTokensRequest) returns (RevokeAllTenantTokensResponse);
}
