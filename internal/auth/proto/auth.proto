syntax = "proto3";

package auth.v1;

option go_package = "erp.localhost/internal/auth/proto/v1;authv1";

message UserAuth {
    string tenant_id = 1;
    string email = 2;
    string username = 3;
}

message UserIdentifier {
    string tenant_id = 1;
    string user_id = 2;
}

message Tokens {
    string access_token = 1;
    string refresh_token = 2;
}

message PermissionResponse {
    string permission = 1;
    bool has_permission = 2;
}

message AuthenticateRequest {
    UserAuth user = 1;
    string password = 2;
}

message AuthenticateResponse {
    UserIdentifier user = 1;
    Tokens tokens = 2;
}

message VerifyTokenRequest {
    string access_token = 1;
}

message VerifyTokenResponse {
    bool valid = 1;
}

message RefreshTokenRequest {
    string refresh_token = 1;
}

message RefreshTokenResponse {
    UserIdentifier user = 1;
    Tokens tokens = 2;
    int64 expires_in = 3;
}

message RevokeTokenRequest {
    Tokens tokens = 1;
}

message RevokeTokenResponse {
    UserIdentifier user = 1;
    bool revoked = 2;
}

message LogoutRequest {
    Tokens tokens = 1;
}

message LogoutResponse {
    bool success = 1;
    string message = 2;
}

message CheckPermissionsRequest {
    UserIdentifier user = 1;
    repeated string permissions = 2;
}

message CheckPermissionsResponse {
    UserIdentifier user = 1;
    repeated PermissionResponse permissions = 2;
}

service AuthService {
    rpc Authenticate(AuthenticateRequest) returns (AuthenticateResponse);
    rpc VerifyToken(VerifyTokenRequest) returns (VerifyTokenResponse);
    rpc RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse);
    rpc RevokeToken(RevokeTokenRequest) returns (RevokeTokenResponse);
    rpc Logout(LogoutRequest) returns (LogoutResponse);
    rpc CheckPermissions(CheckPermissionsRequest) returns (CheckPermissionsResponse);
}